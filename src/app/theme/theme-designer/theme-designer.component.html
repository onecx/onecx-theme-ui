<ocx-portal-page permission="THEME#EDIT" helpArticleId="PAGE_THEME_DESIGNER">
  <ocx-page-header
    [header]="theme ? theme.displayName : 'Theme Designer'"
    [subheader]="'THEME.DESIGNER.' + changeMode + '.SUBHEADER' | translate"
    [actions]="(actions$ | async) ?? []"
    [figureImage]="headerImageUrl"
    [figureBackground]="!headerImageUrl"
  ></ocx-page-header>
  <ocx-page-content>
    <div class="pt-3 px-3 mb-3 flex flex-column row-gap-3">
      <section
        class="sm:ml-2 sm:mr-1 flex flex-wrap justify-content-between align-items-center row-gap-2 column-gap-3"
        [attr.aria-label]="'THEME.DESIGNER.TOP.SECTION' | translate"
      >
        <div
          class="field mb-0 flex flex-wrap sm:flex-nowrap align-items-center row-gap-3 column-gap-3"
          [attr.aria-label]="'THEME.DETAIL.AUTO_APPLY' | translate"
          [pTooltip]="'THEME.DETAIL.AUTO_APPLY.TOOLTIP' | translate"
          tooltipPosition="top"
          tooltipEvent="hover"
        >
          <p-inputSwitch
            inputId="th_designer_header_is_current_theme"
            name="autoApplyToggle"
            [(ngModel)]="autoApply"
            [ariaLabel]="'THEME.DETAIL.AUTO_APPLY' | translate"
            [pTooltip]="'THEME.DETAIL.AUTO_APPLY' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></p-inputSwitch>
          <label for="th_designer_header_is_current_theme" aria-hidden="true">
            {{ 'THEME.DETAIL.AUTO_APPLY' | translate }}
          </label>
        </div>
        <span
          *ngIf="isCurrentTheme"
          class="pi pi-bolt text-primary font-medium"
          [attr.aria-label]="'THEME.DETAIL.AUTO_APPLY_CURRENT_THEME' | translate"
          [pTooltip]="'THEME.DETAIL.AUTO_APPLY_CURRENT_THEME' | translate"
          tooltipPosition="top"
          tooltipEvent="hover"
          role="note"
        >
        </span>
        <div class="field mb-0 w-full sm:w-20rem">
          <span class="p-float-label">
            <p-dropdown
              *ngIf="themes$ | async as themes"
              #themeTemplate
              inputId="th_designer_theme_template"
              [options]="themes ?? []"
              optionLabel="displayName"
              optionValue="name"
              styleClass="w-full"
              (onChange)="onSelectThemeTemplate($event, themes)"
              [showClear]="false"
              [autoDisplayFirst]="false"
              [ariaLabel]="'THEME.TEMPLATE.SELECTOR' | translate"
              [pTooltip]="'THEME.TEMPLATE.SELECTOR.TOOLTIP' | translate"
              tooltipPosition="top"
              tooltipEvent="hover"
            ></p-dropdown>
            <label for="th_designer_fields_selected_theme" class="white-space-nowrap" aria-hidden="true">
              {{ 'THEME.TEMPLATE.SELECTOR' | translate }}
            </label>
          </span>
        </div>
      </section>

      <p-fieldset [toggleable]="false" [collapsed]="false" styleClass="px-1">
        <ng-template pTemplate="header">
          <span [attr.aria-label]="'THEME.GROUPS.BASE' | translate">{{ 'THEME.GROUPS.BASE' | translate }}</span>
        </ng-template>
        <form [formGroup]="basicForm" class="flex flex-column row-gap-4">
          <!-- THEME BASICs -->
          <div *ngIf="changeMode === 'CREATE'" class="flex-grow-1">
            <span class="p-float-label" controlErrorAnchor>
              <input
                pInputText
                type="text"
                id="th_designer_field_name"
                class="w-full pt-3 pb-2 text-responsive"
                formControlName="name"
                [ariaLabel]="'THEME.NAME' | translate"
                [pTooltip]="'THEME.TOOLTIPS.NAME' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              />
              <label class="ocx-required-label" for="th_designer_field_name" aria-hidden="true">
                {{ 'THEME.NAME' | translate }}
              </label>
            </span>
          </div>
          <div
            class="flex flex-row flex-wrap justify-content-start align-items-center column-gap-4 sm:column-gap-5 md:column-gap-6 row-gap-2"
          >
            <span class="flex-grow-1 p-float-label" controlErrorAnchor>
              <input
                pInputText
                minlength="2"
                maxlength="255"
                type="text"
                id="th_designer_field_display_name"
                class="w-full pt-3 pb-2 text-responsive"
                formControlName="displayName"
                [ariaLabel]="'THEME.DISPLAY_NAME' | translate"
                [pTooltip]="'THEME.TOOLTIPS.DISPLAY_NAME' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              />
              <label class="ocx-required-label" for="th_designer_field_display_name" aria-hidden="true">
                {{ 'THEME.DISPLAY_NAME' | translate }}
              </label>
            </span>
            <div class="md:w-10rem">
              <p-checkbox
                ngDefaultControl
                type="text"
                id="th_designer_field_mandatory"
                styleClass="cursor-auto shadow-none"
                formControlName="mandatory"
                [binary]="true"
                [label]="'INTERNAL.MANDATORY' | translate"
                [ariaLabel]="'INTERNAL.MANDATORY' | translate"
                [pTooltip]="'INTERNAL.TOOLTIPS.MANDATORY' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></p-checkbox>
            </div>
          </div>
          <div class="flex-grow-1 p-float-label">
            <input
              pInputText
              type="text"
              id="th_designer_field_description"
              class="w-full pt-3 pb-2 text-responsive"
              formControlName="description"
              [ariaLabel]="'THEME.TOOLTIPS.DESCRIPTION' | translate"
              [pTooltip]="'THEME.TOOLTIPS.DESCRIPTION' | translate"
              tooltipPosition="top"
              tooltipEvent="hover"
            />
            <label for="th_designer_field_description" aria-hidden="true">
              {{ 'THEME.DESCRIPTION' | translate }}
            </label>
          </div>

          <!-- LOGO -->
          <div *ngIf="changeMode !== 'CREATE'" class="flex-grow-1 sm:h-4rem">
            <!-- helper inputs because p-fileupload does not work inside inputgroup -->
            <input #fileUploadLogo hidden type="file" accept="image/*" (change)="onFileUpload($event, RefType.Logo)" />
            <div class="flex flex-wrap sm:flex-nowrap align-items-center row-gap-3 column-gap-4">
              <section
                class="w-4rem pl-2"
                style="color: var(--emphasis-medium)"
                [pTooltip]="'IMAGE.TOOLTIPS.LOGO' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
                aria-hidden="true"
              >
                {{ 'IMAGE.LOGO' | translate }}
              </section>
              <app-image-container
                id="th_designer_logo_url_image"
                styleClass="max-h-3rem max-w-5rem border-round-sm"
                [imageUrl]="imageUrl[RefType.Logo]"
                (imageLoadResult)="onImageLoadResult($event, RefType.Logo)"
              ></app-image-container>
              <button
                pButton
                id="th_designer_action_remove_logo"
                icon="pi pi-trash"
                class="action-button p-button-icon-only"
                [disabled]="!(imageUrl[RefType.Logo] && !imageUrlExists[RefType.Logo])"
                (click)="onRemoveImage(RefType.Logo)"
                [ariaLabel]="'IMAGE.TOOLTIPS.REMOVE' | translate"
                [pTooltip]="'IMAGE.TOOLTIPS.REMOVE' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></button>
              <button
                pButton
                id="th_designer_action_logo_upload"
                icon="pi pi-upload"
                [disabled]=""
                class="action-button p-button-icon-only"
                [disabled]="imageUrlExists[RefType.Logo]"
                (click)="fileUploadLogo.click()"
                [ariaLabel]="'IMAGE.TOOLTIPS.UPLOAD' | translate"
                [pTooltip]="'IMAGE.TOOLTIPS.UPLOAD' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></button>
              <div class="flex flex-column row-gap-1 flex-grow-1">
                <div class="p-inputgroup">
                  <span class="p-float-label w-full">
                    <input
                      pInputText
                      type="text"
                      id="th_designer_field_logo_url"
                      class="w-full pt-3 pb-2 text-responsive"
                      formControlName="logoUrl"
                      (input)="onInputChange($event, RefType.Logo)"
                      [ariaLabel]="('IMAGE.LOGO' | translate) + ':  ' + ('IMAGE.TOOLTIPS.URL' | translate)"
                      [pTooltip]="'IMAGE.TOOLTIPS.URL' | translate"
                      tooltipPosition="top"
                      tooltipEvent="hover"
                    />
                    <label for="th_designer_field_logo_url" aria-hidden="true">{{
                      'IMAGE.LOGO_URL' | translate
                    }}</label>
                  </span>
                  <button
                    id="ws_detail_props_item_logo_url_remove"
                    class="p-inputgroup-addon bg-primary pseudo-button"
                    [ngClass]="changeMode === 'EDIT' && imageUrlExists[RefType.Logo] ? 'cursor-pointer' : 'p-disabled'"
                    (click)="onRemoveImageUrl(RefType.Logo)"
                    [attr.aria-label]="'IMAGE.TOOLTIPS.REMOVE.URL' | translate"
                    [pTooltip]="'IMAGE.TOOLTIPS.REMOVE.URL' | translate"
                    tooltipPosition="right"
                    tooltipEvent="hover"
                  >
                    <span class="pi pi-trash" aria-hidden="true"></span>
                  </button>
                </div>
                <label
                  *ngIf="changeMode === 'EDIT'"
                  class="ocx-control-hint block"
                  style="color: var(--emphasis-medium)"
                  for="ws_detail_props_item_logo_url"
                  aria-hidden="true"
                >
                  {{ ('VALIDATION.HINTS.FORMAT_URL' | translate) + urlPatternAbsolute }}
                </label>
              </div>
            </div>
          </div>

          <!-- LOGO SMALL -->
          <div *ngIf="changeMode !== 'CREATE'" class="flex-grow-1 sm:h-4rem">
            <!-- helper inputs because p-fileupload does not work inside inputgroup -->
            <input
              #fileUploadLogoSmall
              hidden
              type="file"
              accept="image/*"
              (change)="onFileUpload($event, RefType.LogoSmall)"
            />
            <div class="flex flex-wrap sm:flex-nowrap align-items-center row-gap-3 column-gap-4">
              <section
                class="w-4rem pl-2"
                style="color: var(--emphasis-medium)"
                [pTooltip]="'IMAGE.TOOLTIPS.LOGO_SMALL' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
                aria-hidden="true"
              >
                {{ 'IMAGE.LOGO_SMALL' | translate }}
              </section>
              <app-image-container
                id="th_designer_logo_small_url_image"
                styleClass="max-h-3rem max-w-5rem border-round-sm"
                [imageUrl]="imageUrl[RefType.LogoSmall]"
                (imageLoadResult)="onImageLoadResult($event, RefType.LogoSmall)"
              ></app-image-container>
              <button
                pButton
                id="th_designer_action_remove_logo"
                icon="pi pi-trash"
                class="action-button p-button-icon-only"
                [disabled]="!(imageUrl[RefType.LogoSmall] && !imageUrlExists[RefType.LogoSmall])"
                (click)="onRemoveImage(RefType.LogoSmall)"
                [ariaLabel]="'IMAGE.TOOLTIPS.REMOVE' | translate"
                [pTooltip]="'IMAGE.TOOLTIPS.REMOVE' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></button>
              <button
                pButton
                id="th_designer_action_logo_small_upload"
                icon="pi pi-upload"
                [disabled]=""
                class="action-button p-button-icon-only"
                [disabled]="imageUrlExists[RefType.LogoSmall]"
                (click)="fileUploadLogoSmall.click()"
                [ariaLabel]="'IMAGE.TOOLTIPS.UPLOAD' | translate"
                [pTooltip]="'IMAGE.TOOLTIPS.UPLOAD' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></button>
              <div class="flex flex-column row-gap-1 flex-grow-1">
                <div class="p-inputgroup">
                  <span class="p-float-label w-full">
                    <input
                      pInputText
                      type="text"
                      id="th_designer_field_logo_small_url"
                      class="w-full pt-3 pb-2 text-responsive"
                      formControlName="smallLogoUrl"
                      (input)="onInputChange($event, RefType.LogoSmall)"
                      [ariaLabel]="('IMAGE.LOGO_SMALL' | translate) + ':  ' + ('IMAGE.TOOLTIPS.URL' | translate)"
                      [pTooltip]="'IMAGE.TOOLTIPS.URL' | translate"
                      tooltipPosition="top"
                      tooltipEvent="hover"
                    />
                    <label for="th_designer_field_logo_small_url" aria-hidden="true">{{
                      'IMAGE.LOGO_URL' | translate
                    }}</label>
                  </span>
                  <button
                    id="ws_detail_props_item_logo_small_url_remove"
                    class="p-inputgroup-addon bg-primary pseudo-button"
                    [ngClass]="changeMode === 'EDIT' && imageUrlExists[RefType.Logo] ? 'cursor-pointer' : 'p-disabled'"
                    (click)="onRemoveImageUrl(RefType.LogoSmall)"
                    [attr.aria-label]="'IMAGE.TOOLTIPS.REMOVE.URL' | translate"
                    [pTooltip]="'IMAGE.TOOLTIPS.REMOVE.URL' | translate"
                    tooltipPosition="right"
                    tooltipEvent="hover"
                  >
                    <span class="pi pi-trash" aria-hidden="true"></span>
                  </button>
                </div>
                <label
                  class="ocx-control-hint block"
                  style="color: var(--emphasis-medium)"
                  for="ws_detail_props_item_logo_small_url"
                  aria-hidden="true"
                >
                  {{ ('VALIDATION.HINTS.FORMAT_URL' | translate) + urlPatternAbsolute }}
                </label>
              </div>
            </div>
          </div>

          <!-- FAVICON -->
          <div *ngIf="changeMode !== 'CREATE'" class="flex-grow-1 sm:h-4rem">
            <!-- helper inputs because p-fileupload does not work inside inputgroup -->
            <input
              #fileUploadFavicon
              hidden
              type="file"
              accept="image/*"
              (change)="onFileUpload($event, RefType.Favicon)"
            />
            <div class="flex flex-wrap sm:flex-nowrap align-items-center row-gap-3 column-gap-4">
              <section
                class="w-4rem pl-2"
                style="color: var(--emphasis-medium)"
                [pTooltip]="'IMAGE.TOOLTIPS.FAVICON' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
                aria-hidden="true"
              >
                {{ 'IMAGE.FAVICON' | translate }}
              </section>
              <app-image-container
                id="th_designer_favicon_url_image"
                styleClass="max-h-3rem max-w-5rem border-round-sm"
                [imageUrl]="imageUrl[RefType.Favicon]"
                (imageLoadResult)="onImageLoadResult($event, RefType.Favicon)"
              ></app-image-container>
              <button
                pButton
                id="th_designer_action_remove_favicon"
                icon="pi pi-trash"
                class="action-button p-button-icon-only"
                [disabled]="!(imageUrl[RefType.Favicon] && !imageUrlExists[RefType.Favicon])"
                (click)="onRemoveImage(RefType.Favicon)"
                [ariaLabel]="'IMAGE.TOOLTIPS.REMOVE' | translate"
                [pTooltip]="'IMAGE.TOOLTIPS.REMOVE' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></button>
              <button
                pButton
                id="th_designer_action_favicon_upload"
                icon="pi pi-upload"
                class="action-button p-button-icon-only"
                [disabled]="imageUrlExists[RefType.Favicon]"
                (click)="fileUploadFavicon.click()"
                [ariaLabel]="'IMAGE.TOOLTIPS.UPLOAD' | translate"
                [pTooltip]="'IMAGE.TOOLTIPS.UPLOAD' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></button>
              <div class="flex flex-column row-gap-1 flex-grow-1">
                <div class="p-inputgroup">
                  <span class="p-float-label w-full">
                    <input
                      pInputText
                      type="text"
                      id="th_designer_field_favicon_url"
                      class="w-full pt-3 pb-2 text-responsive"
                      formControlName="faviconUrl"
                      (input)="onInputChange($event, RefType.Favicon)"
                      [ariaLabel]="('IMAGE.FAVICON' | translate) + ':  ' + ('IMAGE.TOOLTIPS.URL' | translate)"
                      [pTooltip]="'IMAGE.TOOLTIPS.URL' | translate"
                      tooltipPosition="top"
                      tooltipEvent="hover"
                    />
                    <label for="th_designer_field_favicon_url" aria-hidden="true">
                      {{ 'IMAGE.FAVICON_URL' | translate }}</label
                    >
                  </span>
                  <button
                    id="ws_detail_props_item_favicon_url_remove"
                    class="p-inputgroup-addon bg-primary pseudo-button"
                    [ngClass]="imageUrlExists[RefType.Favicon] ? 'cursor-pointer' : 'p-disabled'"
                    (click)="onRemoveImageUrl(RefType.Favicon)"
                    [attr.aria-label]="'IMAGE.TOOLTIPS.REMOVE.URL' | translate"
                    [pTooltip]="'IMAGE.TOOLTIPS.REMOVE.URL' | translate"
                    tooltipPosition="right"
                    tooltipEvent="hover"
                  >
                    <span class="pi pi-trash" aria-hidden="true"></span>
                  </button>
                </div>
                <label
                  class="ocx-control-hint block"
                  style="color: var(--emphasis-medium)"
                  for="ws_detail_props_item_favicon_url"
                  aria-hidden="true"
                >
                  {{ ('VALIDATION.HINTS.FORMAT_URL' | translate) + urlPatternAbsolute }}
                </label>
              </div>
            </div>
          </div>
        </form>
      </p-fieldset>

      <p-fieldset [toggleable]="false" [collapsed]="false" styleClass="px-1">
        <ng-template pTemplate="header">
          <span>{{ 'THEME.GROUPS.FONT' | translate }}</span>
        </ng-template>
        <form [formGroup]="fontForm" class="flex flex-column sm:flex-row gap-4">
          <div class="flex-grow-1">
            <span class="p-float-label">
              <input
                pInputText
                type="text"
                id="th_designer_font-family"
                formControlName="font-family"
                class="w-full pt-3 pb-2 text-responsive"
                [pTooltip]="'THEME.TOOLTIPS.FONT_FAMILY' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              />
              <label for="th_designer_font-family" aria-hidden="true">font-family</label>
            </span>
          </div>
          <div class="flex-grow-1">
            <span class="p-float-label">
              <input
                pInputText
                type="text"
                id="th_designer_font-size"
                formControlName="font-size"
                class="w-full pt-3 pb-2 text-responsive"
                [pTooltip]="'THEME.TOOLTIPS.FONT_SIZE' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              />
              <label for="th_designer_font-size" aria-hidden="true">font-size</label>
            </span>
          </div>
        </form>
      </p-fieldset>

      <p-fieldset
        *ngFor="let group of groups"
        [toggleable]="false"
        [collapsed]="false"
        styleClass="px-1 color-form-group"
      >
        <ng-template pTemplate="header">
          <span [title]="group.title">{{ group.title }}</span>
        </ng-template>
        <form [formGroup]="group.formGroup" class="grid grid-row-gap">
          <article
            class="col-12 sm:col-6 md:col-4 lg:col-4 xl:col-3"
            *ngFor="let item of themeVars[group.key]"
            [attr.aria-label]="('THEME.TOOLTIPS.ITEM_COLOR' | translate) + ': ' + item"
          >
            <div class="p-inputgroup">
              <span class="p-float-label">
                <input
                  pInputText
                  [id]="'th_designer_item_color_' + item"
                  class="text-responsive"
                  [formControlName]="item"
                  [value]="group.formGroup.value[item]"
                  [ariaLabel]="item"
                />
                <label [for]="'th_designer_item_color_' + item" aria-hidden="true"> {{ item }} </label>
              </span>
              <p-overlayPanel #op>
                <ng-template pTemplate>
                  <div style="width: 240px; display: inline-block">
                    <color-sketch [width]="220" [formControlName]="item"> </color-sketch>
                  </div>
                </ng-template>
              </p-overlayPanel>
              <button
                tabindex="0"
                [id]="'th_designer_item_color_' + item + '_toggle'"
                class="p-inputgroup-addon cursor-pointer pseudo-button"
                (click)="op.toggle($event)"
                (keyup)="op.toggle($event)"
                [ngStyle]="{ 'background-color': group.formGroup.value[item] }"
                [ariaLabel]="'THEME.TOOLTIPS.ITEM_COLOR_PICKER' | translate"
                [pTooltip]="'THEME.TOOLTIPS.ITEM_COLOR_PICKER' | translate"
                tooltipPosition="top"
                tooltipEvent="hover"
              ></button>
            </div>
          </article>
        </form>
      </p-fieldset>
    </div>
  </ocx-page-content>
</ocx-portal-page>

<!-- save as a new theme -->
<p-dialog
  [header]="'ACTIONS.CREATE.THEME' | translate"
  [(visible)]="displaySaveAsDialog"
  [modal]="true"
  [closable]="true"
  [draggable]="true"
  [resizable]="true"
  [style]="{ width: '300px' }"
>
  <div class="mt-1 flex flex-column row-gap-4" [formGroup]="saveAsForm" errorTailor>
    <span class="p-float-label" controlErrorAnchor>
      <input
        pInputText
        id="th_saveas_form_theme_name"
        class="w-full"
        type="text"
        formControlName="themeName"
        [ariaLabel]="'THEME.NAME' | translate"
        [placeholder]="'THEME.NAME' | translate"
        [pTooltip]="'THEME.TOOLTIPS.NAME' | translate"
        tooltipPosition="top"
        tooltipEvent="hover"
      />
      <label for="th_saveas_form_theme_name" class="ocx-required-label" aria-hidden="true">
        {{ 'THEME.NAME' | translate }}
      </label>
    </span>
    <span class="p-float-label" controlErrorAnchor>
      <input
        pInputText
        id="th_saveas_form_display_name"
        class="w-full"
        type="text"
        formControlName="displayName"
        [ariaLabel]="'THEME.DISPLAY_NAME' | translate"
        [placeholder]="'THEME.DISPLAY_NAME' | translate"
        [pTooltip]="'THEME.TOOLTIPS.DISPLAY_NAME' | translate"
        tooltipPosition="top"
        tooltipEvent="hover"
      />
      <label for="th_saveas_form_display_name" class="ocx-required-label" aria-hidden="true">
        {{ 'THEME.DISPLAY_NAME' | translate }}
      </label>
    </span>
  </div>
  <ng-template pTemplate="footer">
    <div class="flex flex-wrap gap-2 justify-content-end">
      <p-button
        icon="pi pi-times"
        styleClass="m-0"
        (onClick)="displaySaveAsDialog = false"
        [label]="'ACTIONS.CANCEL' | translate"
        [ariaLabel]="'ACTIONS.CANCEL' | translate"
        [pTooltip]="'ACTIONS.TOOLTIPS.CANCEL_AND_CLOSE' | translate"
        tooltipPosition="top"
        tooltipEvent="hover"
      ></p-button>
      <p-button
        icon="pi pi-save"
        styleClass="m-0"
        (onClick)="onSaveAsTheme()"
        [disabled]="!saveAsForm.valid"
        [label]="'ACTIONS.SAVE' | translate"
        [ariaLabel]="'ACTIONS.SAVE' | translate"
        [pTooltip]="'ACTIONS.TOOLTIPS.SAVE_AS' | translate"
        tooltipPosition="top"
        tooltipEvent="hover"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>

<!-- confirm the use of a theme as template -->
<p-confirmDialog />
